{% extends 'article/home.html.twig' %}
{% block body %}
{% if app.user %}
<div class="col-md-12 col-sm-12">
    <div class="x_panel">
       <div class="x_title">
        <h2 id="plus" style="font-style: italic;font-family: Verdana, Geneva, Tahoma, sans-serif;"><strong>LISTE DES FEMME DES CHAMBRES</strong></h2>         <ul class="nav navbar-right panel_toolbox">
          <li><a class="collapse-link btn btn-success"><i class="fa fa-plus-circle"></i> Femme de chambre <i class="fa fa-chevron-up"></i></a>
          </li>
         </ul>
         <div class="clearfix"></div>
       </div>
        <div class="x_content">
           <div class="formAdd">
              <form method="post" action="" id="okay1">
                <div class="field item form-group">
                  <label class="col-form-label col-md-3 col-sm-3  label-align">Nom de la femme de chambre :<span style="color: red;"> *</span></label>
                  <div class="form-group col-md-6 col-sm-6">
                    <input type="text" autocomplete="off" class="form-control" name="userNameA" id="userNameA" required="required">
                    <span class="fa fa-user form-control-feedback right" aria-hidden="true"></span>
                  </div>
                </div>
                <div class="field item form-group">
                  <label class="col-form-label col-md-3 col-sm-3  label-align">Prénoms :<span style="color: red;"> *</span></label>
                  <div class="form-group col-md-6 col-sm-6">
                    <input type="text" autocomplete="off" class="form-control" name="prenom" id="prenom" required="required">
                    <span class="fa fa-user form-control-feedback right" aria-hidden="true"></span>
                  </div>
                </div>
                <div class="field item form-group">
                  <label class="col-form-label col-md-3 col-sm-3  label-align">Adresse :<span style="color: red;"> *</span></label>
                  <div class="form-group col-md-6 col-sm-6">
                    <input type="text"  class="form-control" name="adresse" id="adresse" required="required">
                    <span class="fa fa-home form-control-feedback right" aria-hidden="true"></span>
                  </div>
                </div>
                <div class="field item form-group">
                  <label class="col-form-label col-md-3 col-sm-3  label-align">Télpehone :<span style="color: red;"> *</span></label>
                  <div class="form-group col-md-6 col-sm-6">
                    <input type="text" class="form-control" data-inputmask="'mask' : '(999) 999-9999'" name="phone" id="phone" required="required">
                    <span class="fa fa-phone form-control-feedback right" aria-hidden="true"></span>
                  </div>
                </div>
                <div class="ln_solid">
                  <div class="form-group">
                  <div class="col-md-6 offset-md-3">
                    <button type="button" onclick="ajoutUtilisateur()" class="btn btn-primary">Ajouter</button>
                    <button type="button" class="btn btn-danger" onclick="cancel_add()">Annuler</button>
                  </div>
                </div>
                </div>
              </form>
           </div>
                   <!-- /pour la modification  -->
           <div class="modal fade" id="modifficationModal" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <h4 class="modal-title">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Modification d'une femme de chambre </h4>
                  </div>
                  <div class="modal-body">
                      <form name="userForm" class="form-horizontal" method="get" action="">
                         <input type="hidden" name="post_id" id="post_id">
                         <div class="field item form-group">
                          <label class="col-form-label col-md-3 col-sm-3  label-align">Nom : <span style="color: red;"> *</span></label>
                          <div class="form-group col-md-6 col-sm-6">
                            <input type="text" autocomplete="off" class="form-control" name="userNameA1" id="userNameA1" required="required">
                            <span class="fa fa-user form-control-feedback right" aria-hidden="true"></span>
                            <span id="userNameError" class="alert-message"></span>
                          </div>
                        </div>
                        <div class="field item form-group">
                          <label class="col-form-label col-md-3 col-sm-3  label-align">Prénoms : <span style="color: red;"> *</span></label>
                          <div class="form-group col-md-6 col-sm-6">
                            <input type="text" autocomplete="off" class="form-control" name="prenom1" id="prenom1" required="required">
                            <span class="fa fa-user form-control-feedback right" aria-hidden="true"></span>
                          </div>
                        </div>
                        <div class="field item form-group">
                          <label class="col-form-label col-md-3 col-sm-3  label-align">Adresse : <span style="color: red;"> *</span></label>
                          <div class="form-group col-md-6 col-sm-6">
                            <input type="text"  class="form-control" name="adresse1" id="adresse1" required="required">
                            <span class="fa fa-home form-control-feedback right" aria-hidden="true"></span>
                          </div>
                        </div>
                        <div class="field item form-group">
                          <label class="col-form-label col-md-3 col-sm-3  label-align">Télpehone : <span style="color: red;"> *</span></label>
                          <div class="form-group col-md-6 col-sm-6">
                            <input type="text" class="form-control" data-inputmask="'mask' : '(999) 999-9999'" name="phone1" id="phone1">
                            <span class="fa fa-phone form-control-feedback right" aria-hidden="true"></span>
                          </div>
                        </div>
                      </form>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-info" onclick="modifUtilisateur()">Mettre à jour</button>
                      <!-- <button type="submit" class="btn btn-primary">Enregistrer</button> -->
                  </div>
              </div>
            </div>
          </div><!--end of modal-->
        </div>
    </div>
     <div class="row" style="clear: both;margin-top: 18px;">
        <div class="col-12">
          <table id="okay" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nom</th>
                    <th>Prenom</th>
                    <th>Adresse</th>
                    <th>Telephone</th>
                    <th>actions</th>
                    <th>Ménages</th>
                </tr>
            </thead>
            <tbody>
            {% for femme_chambre in femme_chambres %}
            <tr id="row_{{ femme_chambre.id }}" style="text-align: center;">
                     <td><strong>{{ femme_chambre.id }} </strong></td>
                    <td><strong>{{ femme_chambre.nom }} </strong></td>
                    <td><strong>{{ femme_chambre.prenom }} </strong></td>
                    <td><strong>{{ femme_chambre.adresse }} </strong></td>
                    <td><strong>{{ femme_chambre.telephone }} </strong></td>
                    <td><strong>
                      <a href="javascript:void(0)" data-id="{{ femme_chambre.id }}" onclick="editPost(event.target)" class="btn btn-info"><span class="fa fa-pencil-square-o"></span></a>
                      <a href="javascript:void(0)" data-id="{{ femme_chambre.id }}" onclick="deletePost(event.target)" class="btn btn-danger"><span class="fa fa-trash"></span></a>
                     </strong></td>
                    <td><strong><a data-toggle="tooltip"  data-placement="top" title="Liste des chambres occupée" class="btn btn-success" href="{{ path('menage_chambre', {'id': femme_chambre .id}) }}"><span class="fa fa-plus"></span></a> </strong></td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4">Pas de données trouvé </strong></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
       </div>
    </div>
    </div>
    {% endif %}
{% endblock %}
{% block javascripts %}
<script>
   function cancel_add(){
    $('#okay1')[0].reset();
  }
  //editer une valeur
  function editPost(event) {
    let id  = $(event).data("id");
    let _url = `/femme_chambre/${id}/edit`;
    $('#userNameError').text('');
    $.ajax({
      url: _url,
      type: "GET",
      success: function(data) {
          if(data.code==200) {
            $("#post_id").val(data.client.id);
            $("#userNameA1").val(data.client.nom);
            $("#prenom1").val(data.client.prenom);
            $("#adresse1").val(data.client.adresse);
            $("#phone1").val(data.client.phone);
            $("#modifficationModal").modal("show");
          }
      }
    });
  }
  //modification d'une femme de chambre
  function modifUtilisateur() {
    var id = $('#post_id').val();
    var name = $('#userNameA1').val();
    var prenom=$('#prenom1').val();
    var adresse = $('#adresse1').val();
    var phone=$('#phone1').val();

    if(adresse.length>5){
    let _url   = `miseajourfemme`;
     $.ajax({
        url: _url,
        type: "POST",
        data: {
          id : id,
          nom: name.toUpperCase(),
          prenom:prenom,
          adresse: adresse,
          phone:phone,
        },
        async: true,
        success: function(data) {
            if(data.code == 200)
             {
                $("#row_"+id+" td:nth-child(1)").html(id);
                $("#row_"+id+" td:nth-child(2)").html(name.toUpperCase());
                $("#row_"+id+" td:nth-child(3)").html( prenom); 
                $("#row_"+id+" td:nth-child(4)").html( adresse); 
                $("#row_"+id+" td:nth-child(5)").html( phone); 

               $('#userName').val('');
                $("#prenom1").val('');
                $("#adresse1").val('');
                $("#phone1").val('');
                $('#modifficationModal').modal('hide');
             }
        }
      });
    }else{
      alert("Veuillez verifier l'adresse que vous avez entré !!!")
    }
  }
//ajouter un client
  function ajoutUtilisateur() {
  var name =  $('#userNameA').val();
  var prenom=$('#prenom').val();
  var adresse = $('#adresse').val();
  var phone=$('#phone').val();
  if(adresse.length>5){
    let _url     = `femme_chambre_new`;
    $.ajax({
    url: _url,
    type: "POST",
    data: {
      nom: name.toUpperCase(),
      prenom:prenom,
      adresse: adresse,
      phone:phone,
      //accompagne:accompagne
    },
    async: true,
  success: function(data) {
    let linkTwo="/femme_chambre/";
    let numero=data.code.num;
    let linkThree="/showing";
    $(' #okay').prepend('<tr id="row_'+data.code.num+'"><td><strong>'+data.code.num+' </strong></td><td><strong>'+name.toUpperCase()+' </strong></td><td><strong>'+prenom+' </strong></td><td><strong>'+adresse+' </strong></td><td><strong>'+phone+' </strong></td><td><strong><a href="javascript:void(0)" data-id="'+data.code.num+'" onclick="editPost(event.target)" class="btn btn-info"><span class="fa fa-pencil-square-o"></span></a>&nbsp;&nbsp;<a href="javascript:void(0)" data-id="'+data.code.num+'" class="btn btn-danger" onclick="deletePost(event.target)"><span class="fa fa-trash"></span></a> </strong></td><td><strong><a data-toggle="tooltip"  data-placement="top" title="Liste des chambres occupée" class="btn btn-success" href="'+linkTwo+numero+linkThree+'"><span class="fa fa-plus"></span></a> </strong></td></tr>');
    console.log(data.code.num);
  }
  });
  $('#okay1')[0].reset();
  } else{
    alert("Veuillez verifier l'adresse que vous avez entré !!!")
  }

  }
  //supprimer une femme de chambre
  function deletePost(event) {
    let id  = $(event).data(`id`);
    if(id>0){
      let confirmDelete= confirm('Voulez-vous vraiment supprimer cette femme de chamnre ?');
    if (confirmDelete===true)
    {
    let _url = `/femme_chambre/${id}`;
      $.ajax({
        url: _url,
        type: 'GET',
        success: function(data) {
          $("#row_"+id).remove();
        }
      });
    }
    }
   
  }
  </script>
{% endblock %}
